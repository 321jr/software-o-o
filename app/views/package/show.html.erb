<% if @packages.blank? %>
  <div class="py-5">
    <div class="container">
      <h1><%= _("Package %s not found...") % [@pkgname] %></h1>
      <p><a href="/search"><%= _("Back to home page") %></a></p>
    </div>
  </div>
<% else %>

  <header class="my-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <a title="Screenshot of <%= @pkgname %>" rel="lightbox" href="<%= @screenshot %>">
            <img class="img-fluid" src="<%= @thumbnail %>" alt="<%= @pkgname %>" />
          </a>
        </div>
        <div class="col-md-6">
          <h1><%= @name || @pkgname %></h1>
          <% desc_package = search_for_description( @pkgname, @packages ) %>
          <% unless desc_package.blank? %>
            <% unless @appcategories.blank? %>
              <p class="pkg-categorie-note">
                <strong><%=  @appcategories.size > 1 ? _("Categories") : _("Category") %>:</strong>
                <% @appcategories.each do |cat| -%>
                  <%= link_to cat, {:controller => :package, :action => :category, :category => cat}, :class => 'badge badge-info' %>
                <% end -%>
              </p>
            <% end -%>
            <p><strong><%=  desc_package.summary %></strong></p>
            <p id="pkg-desc"><%= prepare_desc desc_package.description -%></p>
            <!-- <i>(from <%= desc_package.project %>)</i> -->
          <%else %>
            <p class="text-muted"><%= _("No description.") %></p>
          <% end -%>

          <% unless @default_package.blank? %>
            <%
              url = url_for :controller => 'download', :action => 'ymp_without_arch_and_version', :query => @pkgname,
              :project => @default_package.project, :repository => @default_package.repository, :package => @pkgname, :base => @default_package.baseproject
            %>
            <ul class="list-inline">
              <li class="list-inline-item"><%= _("Version") %> <%= shorten @default_package.version, 13 %></li>
              <li class="list-inline-item"><%= _("Size") %> <%= number_to_human_size desc_package.size if desc_package %></li>
              <li class="list-inline-item"><%= @default_project_name %></li>
            </ul>
            <a id="one-click-button" class="btn btn-lg btn-primary" href="<%= url %>">
              <span class="typcn typcn-flash-outline"></span>
              <%= _("Direct Install") %>
            </a>
          <% end -%>
        </div><!-- /#package-description -->
      </div><!-- /.row -->
    </div><!-- /.container -->
  </header>

            <div id="pkg-options">
              <ul>
                <% @distributions.each do |distro| -%>
                  <% if (pkgs = @packages.select{|s| s.baseproject == distro[:project]}).size > 0
                  %>

                    <li>
                      <a href="#" onclick=" toggle_dist('<%= distro[:dist_id] %>'); return false;"
                        class="distro-toggle" id="distro-toggle-<%= distro[:dist_id] %>"><b><%= distro[:name] %></b></a>
                      <ul class="pkg-options-details " id="dist_<%= distro[:dist_id] %>" >

                        <%
                        official, pkgs = pkgs.partition{|s| s.project == distro[:project] || s.project == "#{distro[:project]}:NonFree" }
                        update, pkgs = pkgs.partition{|s| s.project == "#{distro[:project]}:Update"}
                        stable, pkgs = pkgs.partition{|s| s.quality == "Stable"} %>

                        <%= render( :partial => 'package/download_rows', :locals => {:packages => official, :distro => distro, :oneclick => true} ) if update.blank? %>
                        <%= render :partial => 'package/download_rows', :locals => {:packages => update, :distro => distro, :oneclick => true} %>
                        <%= render :partial => 'package/download_rows', :locals => {:packages => stable, :distro => distro, :oneclick => true} %>

                        <%
                        home, pkgs = pkgs.partition{|s| s.project.match( /^home\:/ )}
                        devel = pkgs.reject{|s| @official_projects.include?( s.project ) || s.project.match( /^home\:/ ) || s.project.match( /#{distro[:project]}\:Update/ ) ||
                            s.project.match( /#{distro[:project]}\:NonFree/ ) || s.project.match( /openSUSE\:Maintenance\:/ ) } %>

                        <% unless home.blank? && devel.blank? %>
                          <li id="unsupported_link_<%= distro[:dist_id] %>" class="show-unstable-packages hidden">
                            <a class="trigger-show-more" href="#" onclick="toggle_unsupported('<%= distro[:dist_id] %>'); return false;"><%= _("Show unstable packages") %></a></li>
                        <% end -%>
                      </ul>
                      <ul class="pkg-options-details pkg-options-unsupported" id="dist_home_<%= distro[:dist_id] %>" >
                        <%= render :partial => 'package/download_rows', :locals => {:packages => devel, :distro => distro, :oneclick => true} %>
                        <%= render :partial => 'package/download_rows', :locals => {:packages => home, :distro => distro, :oneclick => true} %>
                      </ul>

                    </li>
                  <% end -%>
                <% end -%>

                <% unless @extra_dists.blank?  %>

                  <div id="unsupported-title"><h3><%= _("Unsupported distributions:") %></h3></div>
                  <%  @extra_dists.each do |distro| -%>
                    <li class="extra-dists">
                      <a href="#" onclick=" toggle_dist('<%= escape_for_id distro[:project] %>'); return false;"
                        class="distro-toggle" id="distro-toggle-<%= escape_for_id distro[:project] %>"><b><%= distro[:project].gsub(":", " ").sub("DISCONTINUED", "") %></b></a>
                        <% pks = @extra_packages.select{|p| p.baseproject == distro[:project] } %>
                      <ul class="pkg-options-details pkg-options-unsupported" id="dist_<%= escape_for_id distro[:project] %>" >
                        <%= render :partial => 'download_rows', :locals => {:packages => pks, :distro => distro, :oneclick => false} %>
                      </ul>
                    </li>
                  <% end %>
                <% end %>

                <%= image_tag "expand_all.png", :style => "float: right; ", :class => "hidden", :title => _("Expand all sections ('e')"), :id => "expand-all" %>
                <a id="show-extra-dists" class="hidden" href="#"><%= _("Show more packages for unsupported distributions") %></a>

              </ul>
            </div>


      <% end -%>
    </div>
  </div>
</div>
